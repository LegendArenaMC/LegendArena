package net.thenamedev.legendarena.menu.staffmenu;import net.thenamedev.legendarena.core.*;import net.thenamedev.legendarena.menu.*;import net.thenamedev.legendarena.staffchat.*;import net.thenamedev.legendarena.utils.*;import org.bukkit.*;import org.bukkit.entity.*;import org.bukkit.event.*;import org.bukkit.event.inventory.*;import org.bukkit.inventory.*;import org.bukkit.plugin.*;/** * @author TheNameMan */@SuppressWarnings("deprecation")public class ChatMenu implements Listener {    private Inventory inv;    private Inventory safeInv;    public ChatMenu(Plugin plugin) {        inv = Bukkit.getServer().createInventory(null, 27, ChatColor.RED + "Chat Selector");        ItemStack admin = MenuCore.createItem(Material.BEDROCK, ChatColor.BLUE + "ADMIN", ChatColor.BLUE + "Admin channel.");        ItemStack mod = MenuCore.createItem(Material.GOLD_NUGGET, ChatColor.BLUE + "MOD", ChatColor.BLUE + "Mod channel.");        ItemStack staff = MenuCore.createItem(Material.DIAMOND_SWORD, ChatColor.BLUE + "STAFF", ChatColor.BLUE + "Staff channel.");        ItemStack alert = MenuCore.createItem(Material.DISPENSER, ChatColor.BLUE + "ALERT", ChatColor.BLUE + "Alert channel. [basically a bulk /say]");        ItemStack vip = MenuCore.createItem(Material.EMERALD, ChatColor.BLUE + "VIP", ChatColor.BLUE + "VIP channel.");        ItemStack notify = MenuCore.createItem(Material.BED, ChatColor.BLUE + "NOTIFY", ChatColor.BLUE + "Staff notifications channel.");        ItemStack helper = MenuCore.createItem(Material.REDSTONE_LAMP_OFF, ChatColor.BLUE + "HELPER", ChatColor.BLUE + "Helper channel.");        ItemStack off = MenuCore.createItem(Material.BARRIER, ChatColor.RED + "OFF", ChatColor.BLUE + "Leave all staff channels (and go back to public chat).");        ItemStack so = MenuCore.createItem(new ItemStack(Material.STAINED_GLASS_PANE, 1, (short) 14), ChatColor.RED + "Coming Soon[tm]", ChatColor.RED + "Check back later on this one!");        ItemStack so1 = so.clone();        inv.setItem(0, admin);        inv.setItem(1, notify);        inv.setItem(2, mod);        inv.setItem(3, staff);        inv.setItem(4, alert);        inv.setItem(5, vip);        inv.setItem(6, helper);        inv.setItem(7, so);        inv.setItem(8, so1);        inv.setItem(22, off);        Bukkit.getServer().getPluginManager().registerEvents(this, plugin);        safeInv = Bukkit.getServer().createInventory(null, 27, ChatColor.RED + "Chat Selector"); //make a new inventory as a backup        safeInv.setContents(inv.getContents()); //clone the items    }    public void show(Player p) {        p.openInventory(inv);    }    @EventHandler    public void onInvOpen(InventoryOpenEvent ev) {        Inventory curInv = ev.getInventory();        if(!curInv.getName().equalsIgnoreCase(inv.getName())) return;        curInv.clear(); //Clear the current inventory        curInv.setContents(safeInv.getContents()); //Set the inventory contents with a known good copy        String actualCurrentChannel;        SCType currentChannel = SCType.getType(ev.getPlayer().getUniqueId());        if(currentChannel == null) {            if(LegendArena.debugSwitch) {                actualCurrentChannel = "PUBLIC (null)";            } else {                actualCurrentChannel = "PUBLIC";            }        } else {            actualCurrentChannel = currentChannel.toString();        }        ItemStack current = MenuCore.createItem(Material.PAPER, ChatColor.BLUE + "Current Channel", ChatColor.GREEN + actualCurrentChannel);        curInv.setItem(23, current);        boolean canSeeStaffchat = SCType.canSeeStaffchat(ev.getPlayer().getUniqueId());        ItemStack toggleSee;        if(canSeeStaffchat) {            toggleSee = MenuCore.createItem(Material.GREEN_RECORD, ChatColor.BLUE + "Toggle Staff Chat Visibility", ChatColor.RED + "Click to disable");        } else {            //I know I know, terrible hack to get this to be a Blocks record, but it works, that's all that matters            toggleSee = MenuCore.createItem(Material.getMaterial(2258), ChatColor.BLUE + "Toggle Staff Chat Visibility", ChatColor.GREEN + "Click to enable");        }        curInv.setItem(21, toggleSee);        SCUtils.setItem(curInv, (Player) ev.getPlayer());        SCUtils.setRankPermissions((Player) ev.getPlayer(), curInv);    }    @EventHandler    public void onInventoryClick(InventoryClickEvent e) {        try {            if(!e.getInventory().getName().equalsIgnoreCase(inv.getName())) return;            if(e.getCurrentItem().getItemMeta() == null) return;            if(e.getCurrentItem().getItemMeta().getDisplayName().contains("ADMIN")) {                e.setCancelled(true);                Player p = (Player) e.getWhoClicked();                if(Rank.getRank(p, Rank.Admin))                    SCType.addUser(p.getUniqueId(), SCType.ADMIN);                else                    p.sendMessage(ChatColor.RED + "You cannot join that chat!");                e.getWhoClicked().closeInventory();            } else if(e.getCurrentItem().getItemMeta().getDisplayName().contains("MOD")) {                e.setCancelled(true);                Player p = (Player) e.getWhoClicked();                if(Rank.getRank(p, Rank.Mod))                    SCType.addUser(p.getUniqueId(), SCType.MOD);                else                    p.sendMessage(ChatColor.RED + "You cannot join that chat!");                e.getWhoClicked().closeInventory();            } else if(e.getCurrentItem().getItemMeta().getDisplayName().contains("HELPER")) {                e.setCancelled(true);                Player p = (Player) e.getWhoClicked();                if(Rank.getRank(p, Rank.Helper))                    SCType.addUser(p.getUniqueId(), SCType.HELPER);                else                    p.sendMessage(ChatColor.RED + "You cannot join that chat!");                e.getWhoClicked().closeInventory();            } else if(e.getCurrentItem().getItemMeta().getDisplayName().contains("STAFF")) {                e.setCancelled(true);                Player p = (Player) e.getWhoClicked();                if(Rank.getRank(p, Rank.Helper))                    SCType.addUser(p.getUniqueId(), SCType.STAFF);                else                    p.sendMessage(ChatColor.RED + "You cannot join that chat!");                e.getWhoClicked().closeInventory();            } else if(e.getCurrentItem().getItemMeta().getDisplayName().contains("ALERT")) {                e.setCancelled(true);                Player p = (Player) e.getWhoClicked();                if(Rank.getRank(p, Rank.Mod))                    SCType.addUser(p.getUniqueId(), SCType.ALERT);                else                    p.sendMessage(ChatColor.RED + "You cannot join that chat!");                e.getWhoClicked().closeInventory();            } else if(e.getCurrentItem().getItemMeta().getDisplayName().contains("VIP")) {                e.setCancelled(true);                Player p = (Player) e.getWhoClicked();                if(Rank.getRank(p, Rank.VIP))                    SCType.addUser(p.getUniqueId(), SCType.VIP);                else                    p.sendMessage(ChatColor.RED + "You cannot join that chat!");                e.getWhoClicked().closeInventory();            } else if(e.getCurrentItem().getItemMeta().getDisplayName().contains("NOTIFY")) {                e.setCancelled(true);                Player p = (Player) e.getWhoClicked();                if(Rank.getRank(p, Rank.Dev)) {                    SCType.addUser(p.getUniqueId(), SCType.NOTIFICATION);                } else                    p.sendMessage(ChatColor.RED + "You cannot join that chat!");                e.getWhoClicked().closeInventory();            } else if(e.getCurrentItem().getItemMeta().getDisplayName().contains("OFF")) {                e.setCancelled(true);                Player p = (Player) e.getWhoClicked();                SCType.clearStaffchat(p.getUniqueId());                e.getWhoClicked().closeInventory();            } else if(e.getCurrentItem().getItemMeta().getDisplayName().contains("Toggle")) {                e.setCancelled(true);                Player p = (Player) e.getWhoClicked();                SCType.setCanSeeStaffchat(p.getUniqueId(), !SCType.canSeeStaffchat(p.getUniqueId()));                boolean canSeeStaffchat = SCType.canSeeStaffchat(p.getUniqueId());                ItemStack toggleSee;                if(canSeeStaffchat) {                    toggleSee = MenuCore.createItem(Material.GREEN_RECORD, ChatColor.BLUE + "Toggle Staff Chat Visibility", ChatColor.RED + "Click to disable");                } else {                    //I know I know, terrible hack to get this to be a Blocks record, but it works, that's all that matters                    toggleSee = MenuCore.createItem(Material.getMaterial(2258), ChatColor.BLUE + "Toggle Staff Chat Visibility", ChatColor.GREEN + "Click to enable");                }                e.getInventory().setItem(21, toggleSee);            } else { //failsafe                e.setCancelled(true);            }        } catch(Exception ignore) {            // Ignore the error        }    }}